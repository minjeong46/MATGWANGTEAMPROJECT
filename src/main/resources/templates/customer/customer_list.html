<!DOCTYPE html>
<html layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>문의 목록</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #FAF3EE; padding: 20px; }
        .container { max-width: 900px; margin: auto; padding: 20px; background: white; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #d4c4b7; padding: 10px; text-align: center; }
        th { background-color: #EADBC8; }
        a.detail-link {
            text-decoration: none; color: #C8A888; font-weight: bold;
        }
        a.detail-link:hover { text-decoration: underline; color: #a88c66; }
        button {
            padding: 5px 10px; border: none; background-color: #C8A888;
            color: white; cursor: pointer; border-radius: 5px;
        }
        button:hover { background-color: #a88c66; }
    </style>
</head>

<main layout:fragment="content">
    <div class="container">
        <h2>문의 목록</h2>
        <table>
            <thead>
            <tr>
                <th>번호</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
                <th>상태</th>
                <!-- 관리자만 "변경" 칸을 볼 수 있도록 설정 -->
                <th th:if="${#authorization.expression('hasRole(''ADMIN'')')}">변경</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="customer : ${customers}">
                <td th:text="${customer.custSeq}"></td>
                <!-- 제목을 클릭하면 상세보기 페이지로 이동 -->
                <td>
                    <a th:href="@{/customer/detail/{custSeq}(custSeq=${customer.custSeq})}" class="detail-link" th:text="${customer.custTitle}"></a>
                </td>
                <td th:text="${customer.user.nickname}"></td>
                <td th:text="${#temporals.format(customer.custRegTime, 'yyyy-MM-dd')}"></td>
                <td th:text="${customer.custState.getDisplayName()}"></td>

                <!-- 관리자만 상태 변경 가능 -->
                <td th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
                    <form th:action="@{/customer/update/{custSeq}(custSeq=${customer.custSeq})}" method="post">
                        <select name="state">
                            <option value="PENDING" th:selected="${customer.custState.name() == 'PENDING'}">대기중</option>
                            <option value="IN_PROGRESS" th:selected="${customer.custState.name() == 'IN_PROGRESS'}">처리중</option>
                            <option value="COMPLETED" th:selected="${customer.custState.name() == 'COMPLETED'}">처리완료</option>
                        </select>
                        <button type="submit">변경</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</main>

</html>
