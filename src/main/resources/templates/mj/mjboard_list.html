<!DOCTYPE html>
<html layout:decorate="~{layout}">
<main layout:fragment="content">

    <div class="container mt-5">
        <h2 class="text-center py-3">맛집 소개</h2>

        <!-- 카드형 리스트 -->
        <div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
            <div class="col" th:each="mjboard : ${paging}">
                <div class="card h-100">
                    <img th:src="@{${mjboard.mjFilePath}}" class="card-img-top" style="height: 200px; object-fit: cover;">
                    <div class="card-body">
                        <h5 class="card-title">
                            <a th:href="@{/mjboard/detail/{id}(id=${mjboard.mjSeq})}" th:text="${mjboard.mjTitle}"></a>
                        </h5>
                        <p class="card-text">조회수: <span th:text="${mjboard.mjCnt}"></span></p>
                        <p class="card-text">👍 추천: <span th:text="${#lists.size(mjboard.recommendUsers)}"></span></p>
                        <p class="card-text">
                            ⭐ 평점:
                            <span th:each="star : ${#numbers.sequence(1,5)}"
                                  th:classappend="${star <= starCountMap[mjboard.mjSeq]} ? 'text-warning' : 'text-secondary'"
                                  class="bi bi-star-fill"></span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 검색창 -->
        <div class="input-group my-4">
            <input type="text" id="search_kw" class="form-control" th:value="${kw}" placeholder="검색어 입력">
            <button class="btn btn-warning" type="button" id="btn_search">검색</button>
        </div>

        <!-- 맛집 등록 버튼 -->
        <div class="text-end">
            <a th:href="@{/mjboard/create}" class="btn btn-danger">맛집 등록</a>
        </div>

        <!-- 페이징 -->
        <div class="d-flex justify-content-center mt-4">
            <ul class="pagination">
                <li class="page-item" th:classappend="${paging.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/mjboard/list(page=${paging.number-1}, kw=${kw})}">«</a>
                </li>
                <li th:each="page : ${#numbers.sequence(0, paging.totalPages - 1)}"
                    th:classappend="${page == paging.number} ? 'active'" class="page-item">
                    <a class="page-link" th:href="@{/mjboard/list(page=${page}, kw=${kw})}" th:text="${page+1}"></a>
                </li>
                <li class="page-item" th:classappend="${paging.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/mjboard/list(page=${paging.number+1}, kw=${kw})}">»</a>
                </li>
            </ul>
        </div>
    </div>

    <script>
        const btnSearchEl = document.querySelector("#btn_search");
        const searchEl = document.querySelector("#search_kw");
        btnSearchEl.addEventListener('click', function () {
            location.href = '/mjboard/list?kw=' + encodeURIComponent(searchEl.value);
        });
        searchEl.addEventListener('keyup', function (e) {
            if (e.key === 'Enter') location.href = '/mjboard/list?kw=' + encodeURIComponent(searchEl.value);
        });
    </script>

</main>
</html>
