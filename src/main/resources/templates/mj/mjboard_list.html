<!DOCTYPE html>
<html layout:decorate="~{layout}">
<main layout:fragment="content">

    <div class="d-flex justify-content-center align-items-center page-total-main-bg mb-5 shadow-sm">
        <h2 class="text-center text-white py-2 font-bold-style">ÎßõÏßë ÏÜåÍ∞ú</h2>
    </div>
    <div class="container py-5">
        <section>

        <!-- Ïπ¥ÎìúÌòï Î¶¨Ïä§Ìä∏ -->
        <div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
            <div class="col" th:each="mjboard : ${paging}">
                <div class="card h-100">
                    <!-- Ïç∏ÎÑ§ÏùºÏóê ÎßÅÌÅ¨ Ï∂îÍ∞Ä -->
                    <a th:href="@{/mjboard/detail/{id}(id=${mjboard.mjSeq})}">
                        <img th:if="${imageUrlMap[mjboard.mjSeq] != null}"
                             th:src="${imageUrlMap[mjboard.mjSeq]}"
                             class="card-img-top"
                             style="height:200px; object-fit:cover;"
                             alt="Ïç∏ÎÑ§Ïùº">
                    </a>

                    <div class="card-body">
                        <h5 class="card-title">
                            <a style="text-decoration: none; color: black"
                               th:href="@{/mjboard/detail/{id}(id=${mjboard.mjSeq})}"
                               th:text="${mjboard.mjTitle}"></a>
                        </h5>
                        <!-- Ï∂îÏ≤ú -->
                        <p class="card-text">üëç Ï∂îÏ≤ú: <span th:text="${#lists.size(mjboard.recommendUsers)}"></span></p>
                        <div class="d-flex justify-content-between align-items-center">
                            <!-- ÌèâÏ†ê -->
                            <div>
                                ÌèâÏ†ê:
                                <span th:each="star : ${#numbers.sequence(1,5)}"
                                      th:classappend="${star <= starCountMap[mjboard.mjSeq]} ? 'text-warning' : 'text-secondary'"
                                      class="bi bi-star-fill"></span>
                            </div>
                            <!-- Ï°∞ÌöåÏàò -->
                            <div>Ï°∞ÌöåÏàò: <span th:text="${mjboard.mjCnt}"></span></div>
                        </div>


                        <!-- ÏûëÏÑ±Ïûê, ÏûëÏÑ±ÏùºÏûê (ÏïÑÏù¥ÏΩò Î≥ÄÍ≤Ω Î∞è Ïú†ÏßÄ) -->
                        <div class="d-flex justify-content-between align-items-center mt-3 pt-2 border-top">
                            <small class="text-muted">
                                <i class="bi bi-person-fill"></i>
                                <span th:text="${mjboard.userId.nickname}"></span>
                            </small>
                            <small class="text-muted">
                                <i class="bi bi-calendar-week"></i>
                                <span th:text="${#temporals.format(mjboard.mjRegDate, 'yyyy-MM-dd HH:mm')}"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Í≤ÄÏÉâÏ∞Ω (ÏûëÍ≤å + Ï§ëÏïô Ï†ïÎ†¨) -->
            <div class="d-flex justify-content-center my-4">
                <div class="input-group" style="max-width: 300px;">
                    <input type="text" id="search_kw" class="form-control form-control-sm" th:value="${kw}" placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†•">
                    <button class="btn btn-warning btn-sm" type="button" id="btn_search">Í≤ÄÏÉâ</button>
                </div>
            </div>

            <!-- ÎßõÏßë Îì±Î°ù Î≤ÑÌäº (Ïò§Î•∏Ï™Ω Ï†ïÎ†¨ + ÍπîÎÅî) -->
            <div class="d-flex justify-content-end my-4">
                <a th:href="@{/mjboard/create}" class="btn" style="background: #ec8d53; color: #FFFFFF" >ÎßõÏßë Îì±Î°ù</a>
            </div>


            <!-- ÌéòÏù¥Ïßï -->
        <div class="d-flex justify-content-center mt-4">
            <ul class="pagination">
                <li class="page-item" th:classappend="${paging.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/mjboard/list(page=${paging.number-1}, kw=${kw})}">¬´</a>
                </li>
                <li th:each="page : ${#numbers.sequence(0, paging.totalPages - 1)}"
                    th:classappend="${page == paging.number} ? 'active'" class="page-item">
                    <a class="page-link" th:href="@{/mjboard/list(page=${page}, kw=${kw})}" th:text="${page+1}"></a>
                </li>
                <li class="page-item" th:classappend="${paging.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/mjboard/list(page=${paging.number+1}, kw=${kw})}">¬ª</a>
                </li>
            </ul>
        </div>
    </div>

    <script>
        const btnSearchEl = document.querySelector("#btn_search");
        const searchEl = document.querySelector("#search_kw");
        btnSearchEl.addEventListener('click', function () {
            location.href = '/mjboard/list?kw=' + encodeURIComponent(searchEl.value);
        });
        searchEl.addEventListener('keyup', function (e) {
            if (e.key === 'Enter') location.href = '/mjboard/list?kw=' + encodeURIComponent(searchEl.value);
        });
    </script>

</main>
</html>
